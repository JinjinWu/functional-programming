{- Compile with

     ghc -O2 testEdgeGeographyGame.hs

   so it is not slow.
-}
import Data.List (sort)
import System.Environment (getArgs)
import System.Exit (exitFailure)
import Test.HUnit
import Text.Read (readMaybe)

import EdgeGeographyGame (goodFirstVertices)

sortedGFV = sort . goodFirstVertices

tests =
    [ sortedGFV [(0,[1,2]), (1, [3,4]), (2,[0]), (3,[4]), (4,[])] ~?= [0,2,4]
    , sortedGFV [(0,[2,5]),(1,[0,3,4]),(2,[0,1,4,5]),
                 (3,[1,4,5]),(4,[0,1,2,5]),(5,[1,2,4])] ~?= [2,4]
    -- 0.5x2 mark above
    -- 1x2 marks below
    , sortedGFV long25 ~?= [0,2,4,6,7,16,18,20,23,24]
    , sortedGFV long30 ~?= [12,15,17,20,21,22,25,26,27]
    -- 0.5x2 mark below
    , sortedGFV long32a ~?= [0,2,6,7,10,12,19,20,21,24,25,27,28,30]
    , sortedGFV long32b ~?= [1,5,7,8,9,18,19,20,22,25,29,30]
    ]

-- My solution takes 0.22s.
long25 = [(0,[10,11,12]),(1,[3,8,20]),(2,[9,15]),(3,[2,5,10,11]),(4,[5,11,21]),(5,[6,18,20]),(6,[3,12,14,18,19]),(7,[19]),(8,[2,13,22]),(9,[1,13,23]),(10,[5,12,16]),(11,[12,18]),(12,[7]),(13,[4,15,19,23,24]),(14,[5,6,7,15,20,23]),(15,[20,23]),(16,[9]),(17,[12,18]),(18,[6,19]),(19,[6,11,12,24]),(20,[]),(21,[1,10,14,16]),(22,[5,8,11,16]),(23,[14]),(24,[1,11])]

-- My solution takes 0.64s.
long30 = [(0,[10,12,13]),(1,[3,17]),(2,[3,6,8,22]),(3,[5,15,24]),(4,[17,27]),(5,[12,20,26]),(6,[27]),(7,[1,15,21]),(8,[1,25,28]),(9,[2,15,28]),(10,[0,2,17,19,25]),(11,[15,18,19,26]),(12,[]),(13,[6,12,17,24,26]),(14,[11,21,22,23]),(15,[5,16,18,29]),(16,[2,21]),(17,[18]),(18,[2,12,22]),(19,[21,22,24]),(20,[2,16,18,22,29]),(21,[10]),(22,[0,4,5,14,20]),(23,[2,5,10,12,14]),(24,[14,17]),(25,[5,11,23]),(26,[5,14,19]),(27,[13,18,28]),(28,[12,24,29]),(29,[2,5,9,22])]

long32a = [(0,[22]),(1,[15,19,24]),(2,[5,11]),(3,[12,31]),(4,[20,31]),(5,[0,29]),(6,[5]),(7,[]),(8,[12,14,21,26]),(9,[3,7,22]),(10,[30]),(11,[6,28]),(12,[16,26,27]),(13,[3,7,8,24]),(14,[10,20,29]),(15,[6,22,23,24]),(16,[1,2,3,6,13,15,22]),(17,[9,21,22]),(18,[2,24,31]),(19,[4,8,17]),(20,[29]),(21,[18]),(22,[9,12,17,18,31]),(23,[3,31]),(24,[23,26]),(25,[]),(26,[5,27,31]),(27,[0,5,11,23]),(28,[31]),(29,[3,5,12,23]),(30,[5,10]),(31,[1,16,29])]

long32b = [(0,[12,13,20]),(1,[13]),(2,[3,7,10,11,21,25]),(3,[30]),(4,[15,19,22]),(5,[4]),(6,[0,1,2,18,19]),(7,[11,17,31]),(8,[]),(9,[19]),(10,[23,25,26]),(11,[0,4,13,14,17,30]),(12,[8,10,19,30]),(13,[3,19,24,25,29]),(14,[8]),(15,[16,30]),(16,[8,20]),(17,[0,10,22,31]),(18,[15,28]),(19,[9,12,31]),(20,[4,21,23]),(21,[2,25]),(22,[24,31]),(23,[7,12,18]),(24,[5,15]),(25,[2,13,14]),(26,[12,20,28,31]),(27,[3,7,15,18,25]),(28,[0,2,11,14,25,27,31]),(29,[2,4,23,28]),(30,[]),(31,[13,16,18,19])]

main = do
    args <- getArgs
    case args of
      a:_ | Just n <- readMaybe a, 0 <= n, n < length tests ->
            do c@Counts{errors=e, failures=f} <- runTestTT (tests !! n)
               if e == 0 && f == 0
                   then return c
                   else exitFailure
          | otherwise -> error "No such test number."
      _ -> runTestTT (TestList tests)
